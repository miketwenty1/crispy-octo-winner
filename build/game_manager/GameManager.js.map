{"version":3,"sources":["../../src/game_manager/GameManager.js"],"names":["GameManager","io","spawners","chests","items","monsters","players","playerLocations","chestLocations","monsterLocations","itemLocations","monsterCount","parseMapData","setupEventListeners","setupSpawners","levelData","layers","forEach","layer","name","objects","obj","push","x","Scale","FACTOR","y","properties","value","console","log","on","socket","id","reason","emit","token","frame","decoded","jwt","verify","process","env","JWT_SECRET","JSON","stringify","username","user","spawnPlayer","broadcast","err","message","playerData","checkSocket","flipX","playerAttacking","weaponDirection","email","ChatModel","create","itemId","canPickupItem","addItem","spawnerId","removeObject","removeItem","chestId","bitcoin","updateBitcoin","health","maxHealth","updateHealth","monsterId","reduceAmount","parseInt","respawn","attack","playerAttackValue","loseHealth","playerAttacked","attackedPlayerId","to","config","spawnInterval","Intervals","DEFAULT","limit","spawnerType","spawner","Object","keys","key","SpawnerType","CHEST","Spawner","addChest","bind","deleteChest","MONSTER","addMonster","deleteMonster","moveMonsters","ITEM","deleteItem","playerId","player","PlayerModel","chest","item","monster"],"mappings":"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","sourcesContent":["import jwt from 'jsonwebtoken';\nimport PlayerModel from '../models/PlayerModel';\nimport * as levelData from '../../public/assets/level/large_level.json';\nimport Spawner from './Spawner';\nimport ChatModel from '../models/ChatModel';\n\nimport {\n  SpawnerType, Scale, Intervals,\n} from './utils';\n// in charge of managing game state for player's game\nexport default class GameManager {\n  constructor(io) {\n    this.io = io;\n    this.spawners = {};\n    this.chests = {};\n    this.items = {};\n    this.monsters = {};\n    this.players = {};\n\n    this.playerLocations = [];\n    this.chestLocations = {};\n    this.monsterLocations = {};\n    // itemData.locations;\n    this.itemLocations = {};\n\n    this.monsterCount = 0;\n  }\n\n  setup() {\n    this.parseMapData();\n    this.setupEventListeners();\n    this.setupSpawners();\n  }\n\n  parseMapData() {\n    this.levelData = levelData;\n    this.levelData.layers.forEach((layer) => {\n      if (layer.name === 'player_locations') {\n        layer.objects.forEach((obj) => {\n          this.playerLocations.push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n        });\n      } else if (layer.name === 'monster_locations') {\n        layer.objects.forEach((obj) => {\n          if (this.monsterLocations[obj.properties[0].value]) {\n            this.monsterLocations[obj.properties[0].value].push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n          } else {\n            this.monsterLocations[obj.properties[0].value] = [[obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]];\n          }\n        });\n      } else if (layer.name === 'chest_locations') {\n        layer.objects.forEach((obj) => {\n          if (this.chestLocations[obj.properties[0].value]) {\n            this.chestLocations[obj.properties[0].value].push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n          } else {\n            this.chestLocations[obj.properties[0].value] = [[obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]];\n          }\n        });\n      } else if (layer.name === 'item_locations') {\n        layer.objects.forEach((obj) => {\n          if (this.itemLocations[obj.properties[0].value]) {\n            this.itemLocations[obj.properties[0].value].push([obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]);\n          } else {\n            this.itemLocations[obj.properties[0].value] = [[obj.x * Scale.FACTOR, obj.y * Scale.FACTOR]];\n          }\n        });\n      } else {\n        console.log(layer.name);\n      }\n    });\n  }\n\n  setupEventListeners() {\n    this.io.on('connection', (socket) => {\n      // when a player connects\n      console.log('player connected to our game');\n      console.log(socket.id);\n      socket.on('disconnect', (reason) => {\n        // delete userdata from server\n        delete this.players[socket.id];\n        // emit message to remove this player\n        this.io.emit('playerDisconnect', socket.id);\n        // when a player disconnects\n        console.log(`player disconnected from game because: ${reason}`);\n        console.log(socket.id);\n      });\n\n      socket.on('newPlayer', (token, frame) => {\n        try {\n          // validate token\n          const decoded = jwt.verify(token, process.env.JWT_SECRET);\n          // make sure socket isn't being reused\n          // console.log(this.players);\n          // console.log(socket.id);\n          // console.log(!(socket.id in this.players));\n          if (!(socket.id in this.players)) {\n            // get players name\n            console.log(`new player, with decoded value of ${JSON.stringify(decoded)}`);\n            // console.log(`this is the frame going to the server from newPlayer on socket ${frame}`);\n            const { username } = decoded.user;\n            this.spawnPlayer(socket.id, username, frame);\n\n            // send players to new player\n            socket.emit('currentPlayers', this.players);\n            // send monsters to new player\n            socket.emit('currentMonsters', this.monsters);\n            // send chests to new player\n            socket.emit('currentChests', this.chests);\n            // send item objects to new players\n            socket.emit('currentItems', this.items);\n            // send new player to all players\n            socket.broadcast.emit('spawnPlayer', this.players[socket.id]);\n            // console.log('spawning player');\n            // console.log(this.players[socket.id]);\n          }\n        } catch (err) {\n          // reject login\n          console.log(`err with validating jwt token ${err.message}`);\n          socket.emit('invalidToken');\n        }\n      });\n      socket.on('playerMovement', (playerData) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow playerMovement we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.players[socket.id]) {\n          this.players[socket.id].x = playerData.x;\n          this.players[socket.id].y = playerData.y;\n          this.players[socket.id].flipX = playerData.flipX;\n          this.players[socket.id].playerAttacking = playerData.playerAttacking;\n          this.players[socket.id].weaponDirection = playerData.weaponDirection;\n          // console.log(`yeah ${playerData.weaponDirection.angle}`);\n          // emit message to all players letting them know about the updated position\n          this.io.emit('playerMoved', this.players[socket.id]);\n        }\n      });\n      socket.on('sendMessage', async (message, token) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow sendMessage we got an undefined player');\n          this.checkSocket(socket);\n        } else {\n          try {\n            const decoded = jwt.verify(token, process.env.JWT_SECRET);\n            const { username, email } = decoded.user;\n\n            await ChatModel.create({ email, message });\n            // console.log(username, message);\n            this.io.emit('newMessage', {\n              username,\n              message,\n              frame: this.players[socket.id].frame,\n            });\n          } catch (err) {\n            console.log(`err with validating jwt token ${err.message}`);\n            socket.emit('invalidToken');\n          }\n        }\n      });\n\n      socket.on('pickUpItem', (itemId) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow pickUpChest we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.items[itemId]) {\n          // check to see if player is elgible to pickup item\n          if (this.players[socket.id].canPickupItem()) {\n            this.players[socket.id].addItem(this.items[itemId]);\n            socket.emit('updateItems', this.players[socket.id]);\n            socket.broadcast.emit('updatePlayersItems', socket.id, this.players[socket.id]);\n            // remove item from spawner\n            this.spawners[this.items[itemId].spawnerId].removeObject(itemId);\n          }\n        }\n      });\n\n      socket.on('playerDroppedItem', (itemId) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow pickUpChest we got an undefined player');\n          this.checkSocket(socket);\n        } else {\n          console.log(`item ${itemId} being removed from ${this.players[socket.id].username}`);\n          this.players[socket.id].removeItem(itemId);\n          socket.emit('updateItems', this.players[socket.id]);\n          socket.broadcast.emit('updatePlayersItems', socket.id, this.players[socket.id]);\n        }\n      });\n\n      socket.on('pickUpChest', (chestId) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow pickUpChest we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.chests[chestId]) {\n          // short hand for setting bitcoin variable from chests[chestId].bitcoin this is probably a bad idea.. just trying to learn javascript and see if this works.\n          const { bitcoin } = this.chests[chestId];\n\n          // updating player balance\n          this.players[socket.id].updateBitcoin(bitcoin);\n          socket.emit('updateBalance', this.players[socket.id].bitcoin);\n          socket.broadcast.emit('updatePlayersBalance', socket.id, this.players[socket.id].bitcoin);\n\n          // remove chest this somehow calls deleteChest event (need to verify this).\n          this.spawners[this.chests[chestId].spawnerId].removeObject(chestId);\n        }\n      });\n\n      socket.on('healPlayer', () => {\n        if (!this.players[socket.id]) {\n          console.log('somehow healPlayer we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.players[socket.id].health < this.players[socket.id].maxHealth) {\n          this.players[socket.id].updateHealth(-1);\n          this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n        }\n      });\n      socket.on('monsterOverlap', (monsterId) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow monsterOverlap we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.monsters[monsterId]) {\n          this.players[socket.id].updateHealth(1);\n          this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n\n          if (this.players[socket.id].health <= 0) {\n            // update balance to take a 50% penalty\n            // 10 represents the \"radix\" i believe this should be 10 for base 10 numbering\n            const reduceAmount = parseInt(-this.players[socket.id].bitcoin / 2, 10);\n            // console.log(reduceAmount);\n            this.players[socket.id].updateBitcoin(reduceAmount);\n            socket.emit('updateBalance', this.players[socket.id].bitcoin);\n            // respawn\n            this.players[socket.id].respawn(this.players);\n            this.io.emit('respawnPlayer', this.players[socket.id]);\n          }\n        }\n      });\n\n      socket.on('monsterAttacked', (monsterId) => {\n        // update spawner\n        // console.log('debug: '+ Object.keys(this.players[playerId]));\n        // console.log('playerid: '+playerId);\n        if (!this.players[socket.id]) {\n          console.log('somehow monsterAttacked we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.monsters[monsterId]) {\n          const { bitcoin, attack } = this.monsters[monsterId];\n          const playerAttackValue = this.players[socket.id].attack;\n          this.monsters[monsterId].loseHealth(playerAttackValue);\n          // console.log('health' + this.monsters[monsterId].health);\n          // check health remove monster if dead\n          if (this.monsters[monsterId].health <= 0) {\n            this.players[socket.id].updateBitcoin(bitcoin);\n            socket.emit('updateBalance', this.players[socket.id].bitcoin);\n            // console.log('health2' + this.monsters[monsterId].health);\n            this.spawners[this.monsters[monsterId].spawnerId].removeObject(monsterId);\n            this.io.emit('monsterRemoved', monsterId);\n            // give player some more health if they kill a monster\n            this.players[socket.id].updateHealth(-10);\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n          } else {\n            this.players[socket.id].playerAttacked(attack);\n            // update player health\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n            // update monster health\n            this.io.emit('updateMonsterHealth', monsterId, this.monsters[monsterId].health);\n\n            // respawn player if he be ded\n            if (this.players[socket.id].health <= 0) {\n              // update balance to take a 50% penalty\n              // 10 represents the \"radix\" i believe this should be 10 for base 10 numbering\n              const reduceAmount = parseInt(-this.players[socket.id].bitcoin / 2, 10);\n              // console.log(reduceAmount);\n              this.players[socket.id].updateBitcoin(reduceAmount);\n              socket.emit('updateBalance', this.players[socket.id].bitcoin);\n              // respawn\n              this.players[socket.id].respawn(this.players);\n              this.io.emit('respawnPlayer', this.players[socket.id]);\n            }\n          }\n        }\n      });\n      socket.on('attackedPlayer', (attackedPlayerId) => {\n        if (!this.players[socket.id]) {\n          console.log('somehow attackedPlayer we got an undefined player');\n          this.checkSocket(socket);\n        } else if (this.players[attackedPlayerId]) {\n          // get balance\n          const { bitcoin } = this.players[attackedPlayerId];\n          const playerAttackValue = this.players[socket.id].attack;\n          // subtract health\n          this.players[attackedPlayerId].playerAttacked(playerAttackValue);\n          // check health of attacked player if dead send gold to attacker\n          if (this.players[attackedPlayerId].health <= 0) {\n            // dead player loses half of the gold to attacker\n            this.players[socket.id].updateBitcoin(bitcoin);\n            // respawn attacked player\n            this.players[attackedPlayerId].respawn(this.players);\n            this.io.emit('respawnPlayer', this.players[attackedPlayerId]);\n            // send update balance message to player\n            socket.emit('updateBalance', this.players[socket.id].bitcoin);\n            // reset dead players gold\n            this.players[attackedPlayerId].updateBitcoin(-bitcoin);\n            // io.to sends to a specific socket\n            this.io.to(`${attackedPlayerId}`).emit('updateBalance', this.players[attackedPlayerId].bitcoin);\n            // add bonus health to player\n            this.players[socket.id].updateHealth(-20);\n            this.io.emit('updatePlayerHealth', socket.id, this.players[socket.id].health);\n          } else {\n            this.io.emit('updatePlayerHealth', attackedPlayerId, this.players[attackedPlayerId].health);\n          }\n        }\n      });\n      console.log('new player connected', socket.id);\n    });\n  }\n\n  setupSpawners() {\n    const config = {\n      spawnInterval: Intervals.DEFAULT,\n      limit: 3,\n      spawnerType: '',\n      id: '',\n    };\n    let spawner;\n    Object.keys(this.chestLocations).forEach((key) => {\n      config.id = `chest-${key}`;\n      config.spawnerType = SpawnerType.CHEST;\n      spawner = new Spawner(\n        config,\n        this.chestLocations[key],\n        this.addChest.bind(this),\n        this.deleteChest.bind(this),\n      );\n      this.spawners[spawner.id] = spawner;\n    });\n\n    Object.keys(this.monsterLocations).forEach((key) => {\n      config.id = `monster-${key}`;\n      config.spawnerType = SpawnerType.MONSTER;\n      spawner = new Spawner(\n        config,\n        this.monsterLocations[key],\n        this.addMonster.bind(this),\n        this.deleteMonster.bind(this),\n        this.moveMonsters.bind(this),\n      );\n      this.spawners[spawner.id] = spawner;\n    });\n\n    // create item spawner\n    Object.keys(this.itemLocations).forEach((key) => {\n      config.id = `item-${key}`;\n      config.spawnerType = SpawnerType.ITEM;\n      config.limit = 1;\n      config.spawnInterval = 1000 * 30;\n      spawner = new Spawner(\n        config,\n        this.itemLocations[key],\n        this.addItem.bind(this),\n        this.deleteItem.bind(this),\n      );\n      this.spawners[spawner.id] = spawner;\n    });\n  }\n\n  spawnPlayer(playerId, username, frame) {\n    const player = new PlayerModel(playerId, this.playerLocations, this.players, username, frame);\n    this.players[playerId] = player;\n  }\n\n  addChest(chestId, chest) {\n    this.chests[chestId] = chest;\n    this.io.emit('chestSpawned', chest);\n  }\n\n  deleteChest(chestId) {\n    delete this.chests[chestId];\n    this.io.emit('chestRemoved', chestId);\n  }\n\n  addItem(itemId, item) {\n    this.items[itemId] = item;\n    this.io.emit('itemSpawned', item);\n  }\n\n  deleteItem(itemId) {\n    delete this.items[itemId];\n    this.io.emit('itemRemoved', itemId);\n  }\n\n  addMonster(monsterId, monster) {\n    this.monsters[monsterId] = monster;\n    this.io.emit('monsterSpawned', monster);\n  }\n\n  deleteMonster(monsterId) {\n    delete this.monsters[monsterId];\n    this.io.emit('monsterRemoved', monsterId);\n  }\n\n  moveMonsters() {\n    this.io.emit('monsterMovement', this.monsters);\n  }\n\n  checkSocket(socket) {\n    if (!this.players[socket.id]) {\n      this.io.emit('playerDisconnect', socket.id);\n      console.log('err with validating jwt token during checkSocket()');\n      socket.emit('invalidToken');\n    }\n  }\n}\n"],"file":"GameManager.js"}